(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function a(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=a(e);fetch(e.href,t)}})();let c={video:{facingMode:"user",width:1280,height:720},audio:!1},s=document.getElementById("webcam"),n=document.getElementById("switchCamButton"),h=!1;window.startAR=function(){class r{constructor(t,i,d,g){this.cannyTres1=t,this.cannyTres2=i,this.cannyAperture=d,this.FPS=g,this.webcam=document.getElementById("webcam")}onVideoLoaded(t,i,d){this.webcam=t,this.transferCanvId=i,this.displayCanvId=d,this.width=t.videoWidth,this.height=t.videoHeight,this.context=document.getElementById(i).getContext("2d",{willReadFrequently:!0}),this.context.canvas.width=this.width,this.context.canvas.height=this.height,this.rgba1=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.rgba2=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.gray1=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.startProcessing()}startProcessing(){if(this.stopped===!0)return;let t=Date.now();this.context.drawImage(this.webcam,0,0,this.width,this.height),this.rgba1.data.set(this.context.getImageData(0,0,this.width,this.height).data),cv.cvtColor(this.rgba1,this.gray1,cv.COLOR_RGBA2GRAY),console.log("canny"),cv.Canny(this.gray1,this.gray1,this.cannyTres1,this.cannyTres2,this.cannyAperture,!0),cv.imshow(this.displayCanvId,this.gray1);let i=1e3/this.FPS-(Date.now()-t);setTimeout(this.startProcessing.bind(this),i)}stopProcessing(){this.stopped=!0,this.rgba1.delete(),this.rgba2.delete(),this.gray1.delete()}}let a=new r(150,130,3,30),o=n.cloneNode(!0);n.parentElement.replaceChild(o,n),n.remove(),n=o,n.addEventListener("click",()=>{if(!h){a.stopProcessing(),c.video.facingMode==="environment"?c.video.facingMode="user":c.video.facingMode="environment",h=!0;let e=s.cloneNode(!0);s.parentElement.replaceChild(e,s),s.remove(),s=e,window.startAR()}}),navigator.mediaDevices.getUserMedia(c).then(function(e){console.log("Loading webcam..."),s.srcObject=e,s.play(),s.addEventListener("loadeddata",()=>{h=!1,a.onVideoLoaded(s,"transferCanvas","displayCanvas")})}).catch(function(e){console.log("An error occurred! "+e)})};
