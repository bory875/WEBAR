(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const i of e.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&d(i)}).observe(document,{childList:!0,subtree:!0});function l(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function d(t){if(t.ep)return;t.ep=!0;const e=l(t);fetch(t.href,e)}})();let u={video:{facingMode:"environment",width:1280,height:720},audio:!1},s=document.getElementById("webcam"),c=document.getElementById("switchCamButton"),o=document.getElementById("applyButton"),f=document.getElementById("blurCheck"),w=document.getElementById("blurRange"),p=document.getElementById("cannyCheck"),g=!1;window.startAR=function(){class h{constructor(e,i,n,m){this.blurChecked=f.checked,this.blurAmount=parseInt(w.value),this.cannyChecked=p.checked,this.cannyTres1=e,this.cannyTres2=i,this.cannyAperture=n,this.bluir,this.matrices={},this.points={},this.scalars={},this.FPS=m,this.webcam=document.getElementById("webcam");let r=c.cloneNode(!0);c.parentElement.replaceChild(r,c),c.remove(),c=r;let a=o.cloneNode(!0);o.parentElement.replaceChild(a,o),o.remove(),o=a}onVideoLoaded(e,i,n){this.webcam=e,this.transferCanvId=i,this.displayCanvId=n,this.width=e.videoWidth,this.height=e.videoHeight,this.context=document.getElementById(i).getContext("2d",{willReadFrequently:!0}),this.context.canvas.width=this.width,this.context.canvas.height=this.height,this.matrices.rgba1=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.matrices.gray1=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.matrices.gray2=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.matrices.rgb1=new cv.Mat(this.height,this.width,cv.CV_8UC3),this.matrices.dilateKernel=new cv.Mat.ones(3,3,cv.CV_8U),this.points.anchor=new cv.Point(-1,-1),this.color=new cv.Scalar(255,0,0),console.log("Processing video.."),this.startProcessing()}startProcessing(){if(this.stopped===!0)return;let e=Date.now();this.loadImage(),cv.cvtColor(this.matrices.rgba1,this.matrices.gray1,cv.COLOR_RGBA2GRAY),this.blurChecked?cv.GaussianBlur(this.matrices.gray1,this.matrices.gray2,new cv.Size(this.blurAmount,this.blurAmount),10,0,cv.BORDER_DEFAULT):this.matrices.gray2=this.matrices.gray1.clone(),cv.Canny(this.matrices.gray2,this.matrices.gray2,this.cannyTres1,this.cannyTres2,this.cannyAperture,!1),cv.dilate(this.matrices.gray2,this.matrices.gray2,this.matrices.dilateKernel,this.points.anchor,1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue());let i=new cv.MatVector,n=new cv.Mat;cv.findContours(this.matrices.gray2,i,n,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE);for(let r=0;r<i.size();++r){let a=new cv.Mat;cv.convexHull(i.get(r),a,!1,!0),i.set(r,a),a.delete();let y=new cv.Scalar(Math.round(Math.random()*100+155),Math.round(Math.random()*100+155),Math.round(Math.random()*100+155),255);cv.drawContours(this.matrices.rgba1,i,r,y,2,cv.LINE_8,n,100)}i.delete(),n.delete(),cv.imshow(this.displayCanvId,this.matrices.rgba1);let m=1e3/this.FPS-(Date.now()-e);setTimeout(this.startProcessing.bind(this),m)}loadImage(){this.context.drawImage(this.webcam,0,0,this.width,this.height),this.matrices.rgba1.data.set(this.context.getImageData(0,0,this.width,this.height).data)}stopProcessing(){this.stopped=!0;for(let e in this.matrices)this.matrices[e].delete()}}const l=new h(150,250,3,30);function d(t){if(!g){l.stopProcessing(),t&&(u.video.facingMode==="environment"?u.video.facingMode="user":u.video.facingMode="environment"),g=!0;let e=s.cloneNode(!0);s.parentElement.replaceChild(e,s),s.remove(),s=e,window.startAR()}}c.addEventListener("click",()=>{d(!0)}),o.addEventListener("click",()=>{d(!1)}),navigator.mediaDevices.getUserMedia(u).then(function(t){console.log("Loading webcam..."),s.srcObject=t,s.play(),s.addEventListener("loadeddata",()=>{g=!1,l.onVideoLoaded(s,"transferCanvas","displayCanvas")})}).catch(function(t){console.log("An error occurred! "+t)})};
