(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))h(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const i of e.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&h(i)}).observe(document,{childList:!0,subtree:!0});function r(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function h(t){if(t.ep)return;t.ep=!0;const e=r(t);fetch(t.href,e)}})();let l={video:{facingMode:"environment",width:1280,height:720},audio:!1},s=document.getElementById("webcam"),c=document.getElementById("switchCamButton");document.getElementById("applyButton");document.getElementById("blurCheck");document.getElementById("blurRange");document.getElementById("cannyCheck");let u=!1;window.startAR=function(){class o{constructor(e){this.matrices={},this.points={},this.scalars={},this.FPS=e,this.webcam=document.getElementById("webcam");let i=c.cloneNode(!0);c.parentElement.replaceChild(i,c),c.remove(),c=i}onVideoLoaded(e,i,a){this.webcam=e,this.transferCanvId=i,this.displayCanvId=a,this.width=e.videoWidth,this.height=e.videoHeight,this.context=document.getElementById(i).getContext("2d",{willReadFrequently:!0}),this.context.canvas.width=this.width,this.context.canvas.height=this.height,console.log(this.context.canvas.width),this.matrices.rgba1=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.matrices.rgba2=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.matrices.gray1=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.matrices.gray2=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.matrices.rgb1=new cv.Mat(this.height,this.width,cv.CV_8UC3),this.matrices.dilateKernel=new cv.Mat.ones(3,3,cv.CV_8U),this.points.anchor=new cv.Point(-1,-1),this.color=new cv.Scalar(255,0,0),console.log("Processing video.."),this.startProcessing()}startProcessing(){if(this.stopped===!0)return;let e=Date.now();if(this.loadImage(),typeof this.matrices.sample<"u"){let a=new cv.Mat(this.matrices.rgba1.rows,this.matrices.rgba1.cols,this.matrices.rgba1.type(),new cv.Scalar(this.averageRGB[0]-20,this.averageRGB[1]-20,this.averageRGB[2]-20,255)),n=new cv.Mat(this.matrices.rgba1.rows,this.matrices.rgba1.cols,this.matrices.rgba1.type(),new cv.Scalar(this.averageRGB[0]+20,this.averageRGB[1]+20,this.averageRGB[2]+20,255));cv.inRange(this.matrices.rgba1,a,n,this.matrices.rgba2),a.delete(),n.delete()}typeof this.matrices.sample>"u"?cv.imshow(this.displayCanvId,this.matrices.rgba1):cv.imshow(this.displayCanvId,this.matrices.rgba2);let i=1e3/this.FPS-(Date.now()-e);setTimeout(this.startProcessing.bind(this),i)}loadImage(){this.context.drawImage(this.webcam,0,0,this.width,this.height),this.matrices.rgba1.data.set(this.context.getImageData(0,0,this.width,this.height).data)}getSamples(e){let i=100;this.matrices.sample=this.matrices.rgba1.roi(new cv.Rect(e.pageX-i/2,e.pageY-i/2,i,i)),console.log("aaaa"),cv.imshow("displayCanvas2",this.matrices.sample),this.calculateAverage(i)}calculateAverage(e){let i=0,a=0,n=0;for(let d=0;d<e;d++)for(let g=0;g<e;g++){let m=this.matrices.sample.ucharPtr(d,g);i+=m[0],a+=m[1],n+=m[2]}this.averageRGB=new cv.Scalar(Math.round(i/(e*e)),Math.round(a/(e*e)),Math.round(n/(e*e)),255),console.log(this.averageRGB)}stopProcessing(){this.stopped=!0;for(let e in this.matrices)this.matrices[e].delete()}}const r=new o(30);function h(t){if(!u){r.stopProcessing(),l.video.facingMode==="environment"?l.video.facingMode="user":l.video.facingMode="environment",u=!0;let e=s.cloneNode(!0);s.parentElement.replaceChild(e,s),s.remove(),s=e,window.startAR()}}c.addEventListener("click",()=>{h()}),navigator.mediaDevices.getUserMedia(l).then(function(t){console.log("Loading webcam..."),s.srcObject=t,s.play(),s.addEventListener("loadeddata",()=>{u=!1,r.onVideoLoaded(s,"transferCanvas","displayCanvas")})}).catch(function(t){console.log("An error occurred! "+t)}),document.addEventListener("click",r.getSamples.bind(r))};
