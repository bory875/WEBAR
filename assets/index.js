(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const i of e.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function c(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function o(t){if(t.ep)return;t.ep=!0;const e=c(t);fetch(t.href,e)}})();let h={video:{facingMode:"environment",width:1280,height:720},audio:!1},a=document.getElementById("webcam"),d=document.getElementById("switchCamButton"),f=document.getElementById("transferCanvas");document.getElementById("displayCanvas");document.getElementById("applyButton");document.getElementById("blurCheck");document.getElementById("blurRange");document.getElementById("cannyCheck");let l=!1;function g(r){let s=r.cloneNode(!0);return r.parentElement.replaceChild(s,r),r.remove(),s}window.startAR=function(){class s{constructor(e){this.matrices={},this.points={},this.scalars={},this.FPS=e,this.webcam=a,d=g(d)}onVideoLoaded(e){this.webcam=e,this.width=e.videoWidth,this.height=e.videoHeight,this.context=f.getContext("2d",{willReadFrequently:!0}),this.context.canvas.width=this.width,this.context.canvas.height=this.height,this.matrices.rgba1=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.matrices.rgba2=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.matrices.hsv1=new cv.Mat(this.height,this.width,cv.CV_8UC3),this.matrices.hsv2=new cv.Mat(this.height,this.width,cv.CV_8UC3),this.matrices.gray1=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.matrices.gray2=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.matrices.rgb1=new cv.Mat(this.height,this.width,cv.CV_8UC3),this.matrices.dilateKernel=new cv.Mat.ones(3,3,cv.CV_8U),this.points.anchor=new cv.Point(-1,-1),this.color=new cv.Scalar(255,0,0),this.startProcessing()}startProcessing(){if(this.stopped===!0)return;console.log("Processing video..");let e=Date.now();this.loadImage(),cv.cvtColor(this.matrices.rgba1,this.matrices.gray1,cv.COLOR_RGBA2GRAY),cv.GaussianBlur(this.matrices.gray1,this.matrices.gray2,new cv.Size(3,3),10,0,cv.BORDER_DEFAULT),cv.Canny(this.matrices.gray2,this.matrices.gray2,150,250,3,!1);let i=new cv.Mat;cv.HoughLinesP(this.matrices.gray2,i,1,Math.PI/180,2,50,10),cv.cvtColor(this.matrices.gray2,this.matrices.rgba1,cv.COLOR_GRAY2RGBA);for(let n=0;n<i.rows;++n){let u=new cv.Scalar(Math.round(Math.random()*100+155),Math.round(Math.random()*100+155),Math.round(Math.random()*100+155),255),v=new cv.Point(i.data32S[n*4],i.data32S[n*4+1]),w=new cv.Point(i.data32S[n*4+2],i.data32S[n*4+3]);cv.line(this.matrices.rgba1,v,w,u,2)}cv.imshow("displayCanvas",this.matrices.rgba1);let m=1e3/this.FPS-(Date.now()-e);setTimeout(this.startProcessing.bind(this),m)}loadImage(){this.context.drawImage(this.webcam,0,0,this.width,this.height),this.matrices.rgba1.data.set(this.context.getImageData(0,0,this.width,this.height).data)}stopProcessing(){this.stopped=!0;for(let e in this.matrices)this.matrices[e].delete()}}const c=new s(30);function o(t){l||(c.stopProcessing(),h.video.facingMode==="environment"?h.video.facingMode="user":h.video.facingMode="environment",l=!0,a=g(a),window.startAR())}d.addEventListener("click",()=>{o()}),navigator.mediaDevices.getUserMedia(h).then(function(t){console.log("Loading webcam..."),a.srcObject=t,a.play(),a.addEventListener("loadeddata",()=>{l=!1,c.onVideoLoaded(a,"transferCanvas","displayCanvas")})}).catch(function(t){console.log("An error occurred! "+t)})};
