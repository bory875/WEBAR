(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))d(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&d(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function d(e){if(e.ep)return;e.ep=!0;const t=o(e);fetch(e.href,t)}})();let g={video:{facingMode:"environment",width:1280,height:720},audio:!1},c=document.getElementById("webcam"),v=document.getElementById("switchCamButton"),p=document.getElementById("transferCanvas"),u=document.getElementById("displayCanvas");document.getElementById("applyButton");document.getElementById("blurCheck");document.getElementById("blurRange");document.getElementById("cannyCheck");let w=!1;function f(n){let r=n.cloneNode(!0);return n.parentElement.replaceChild(r,n),n.remove(),r}window.startAR=function(){class r{constructor(t){this.matrices={},this.points={},this.scalars={},this.FPS=t,this.webcam=c,v=f(v)}onVideoLoaded(t){this.webcam=t,this.width=t.videoWidth,this.height=t.videoHeight,this.context=p.getContext("2d",{willReadFrequently:!0}),this.context.canvas.width=this.width,this.context.canvas.height=this.height,this.matrices.rgba1=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.matrices.rgba2=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.matrices.hsv1=new cv.Mat(this.height,this.width,cv.CV_8UC3),this.matrices.hsv2=new cv.Mat(this.height,this.width,cv.CV_8UC3),this.matrices.gray1=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.matrices.gray2=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.matrices.rgb1=new cv.Mat(this.height,this.width,cv.CV_8UC3),this.matrices.dilateKernel=new cv.Mat.ones(3,3,cv.CV_8U),this.points.anchor=new cv.Point(-1,-1),this.color=new cv.Scalar(255,0,0),this.startProcessing()}startProcessing(){if(this.stopped===!0)return;console.log("Processing video..");let t=Date.now();this.loadImage(),cv.cvtColor(this.matrices.rgba1,this.matrices.gray1,cv.COLOR_RGBA2GRAY),cv.GaussianBlur(this.matrices.gray1,this.matrices.gray2,new cv.Size(3,3),10,0,cv.BORDER_DEFAULT),cv.Canny(this.matrices.gray2,this.matrices.gray2,150,250,3,!1);let i=new cv.MatVector,s=new cv.Mat;cv.findContours(this.matrices.gray2,i,s,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE);for(let a=0;a<i.size();++a){let l=new cv.Scalar(Math.round(Math.random()*100+155),Math.round(Math.random()*100+155),Math.round(Math.random()*100+155),255);cv.drawContours(this.matrices.rgba1,i,a,l,2,cv.LINE_8,s,100)}i.delete(),s.delete(),cv.imshow("displayCanvas",this.matrices.rgba1);let h=1e3/this.FPS-(Date.now()-t);setTimeout(this.startProcessing.bind(this),h)}loadImage(){this.context.drawImage(this.webcam,0,0,this.width,this.height),this.matrices.rgba1.data.set(this.context.getImageData(0,0,this.width,this.height).data)}getSamples(t){let i=10,s=u.getBoundingClientRect(),h=u.width/s.width,a=u.height/s.height;this.matrices.sample=this.matrices.rgba1.roi(new cv.Rect((t.pageX-s.left)*h-i/2,(t.pageY-s.top)*a-i/2,i,i)),cv.imshow("displayCanvas2",this.matrices.sample),this.calculateAverage(i)}calculateAverage(t){let i=0,s=0,h=0;for(let a=0;a<t;a++)for(let l=0;l<t;l++){let m=this.matrices.sample.ucharPtr(a,l);i+=m[0],s+=m[1],h+=m[2]}this.averageRGB=new cv.Scalar(Math.round(i/(t*t)),Math.round(s/(t*t)),Math.round(h/(t*t)),255),typeof this.matrices.low<"u"&&this.matrices.low.delete(),this.matrices.low=new cv.Mat(this.matrices.rgba1.rows,this.matrices.rgba1.cols,this.matrices.rgba1.type(),new cv.Scalar(this.averageRGB[0]-20,this.averageRGB[1]-20,this.averageRGB[2]-20,255)),typeof this.matrices.high<"u"&&this.matrices.high.delete(),this.matrices.high=new cv.Mat(this.matrices.rgba1.rows,this.matrices.rgba1.cols,this.matrices.rgba1.type(),new cv.Scalar(this.averageRGB[0]+20,this.averageRGB[1]+20,this.averageRGB[2]+20,255))}stopProcessing(){this.stopped=!0;for(let t in this.matrices)this.matrices[t].delete()}}const o=new r(30);function d(e){w||(o.stopProcessing(),g.video.facingMode==="environment"?g.video.facingMode="user":g.video.facingMode="environment",w=!0,c=f(c),window.startAR())}v.addEventListener("click",()=>{d()}),navigator.mediaDevices.getUserMedia(g).then(function(e){console.log("Loading webcam..."),c.srcObject=e,c.play(),c.addEventListener("loadeddata",()=>{w=!1,o.onVideoLoaded(c,"transferCanvas","displayCanvas")})}).catch(function(e){console.log("An error occurred! "+e)}),document.addEventListener("click",o.getSamples.bind(o))};
