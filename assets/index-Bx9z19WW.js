(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const s of e.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function h(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function c(t){if(t.ep)return;t.ep=!0;const e=h(t);fetch(t.href,e)}})();let d={video:{facingMode:"user",width:1280,height:720},audio:!1},o=document.getElementById("webcam"),n=document.getElementById("switchCamButton"),u=!1;window.startAR=function(){class r{constructor(e,s,i,a){this.cannyTres1=e,this.cannyTres2=s,this.cannyAperture=i,this.FPS=a,this.webcam=document.getElementById("webcam")}onVideoLoaded(e,s,i){this.webcam=e,this.transferCanvId=s,this.displayCanvId=i,this.width=e.videoWidth,this.height=e.videoHeight,this.context=document.getElementById(s).getContext("2d",{willReadFrequently:!0}),this.context.canvas.width=this.width,this.context.canvas.height=this.height,this.rgba1=new cv.Mat(this.height,this.width,cv.CV_8UC4),this.gray1=new cv.Mat(this.height,this.width,cv.CV_8UC1),this.rgb1=new cv.Mat(this.height,this.width,cv.CV_8UC3),this.dilateKernel=cv.Mat.ones(3,3,cv.CV_8U),this.anchor=new cv.Point(-1,-1),this.color=new cv.Scalar(255,0,0),this.startProcessing()}startProcessing(){if(this.stopped===!0)return;let e=Date.now();this.lines=new cv.Mat,this.lines.delete(),this.loadImage(),cv.cvtColor(this.rgba1,this.gray1,cv.COLOR_RGBA2GRAY),cv.Canny(this.gray1,this.gray1,this.cannyTres1,this.cannyTres2,this.cannyAperture,!0),this.contours=new cv.MatVector,this.hierarchy=new cv.Mat,console.log("Finding contours..."),cv.findContours(this.gray1,this.contours,this.hierarchy,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE),console.log("Drawing contours..."),console.log(this.contours.size()),this.rgb1.delete(),this.rgb1=new cv.Mat.zeros(this.height,this.width,cv.CV_8UC3);for(let i=0;i<this.contours.size();++i){if(cv.contourArea(this.contours.get(i),!1)<100)continue;let a=new cv.Mat;cv.approxPolyDP(this.contours.get(i),a,10,!0),this.contours.set(i,a),a.delete();let l=new cv.Mat;cv.convexHull(this.contours.get(i),l,!1,!0),this.contours.set(i,l),l.delete();let v=new cv.Scalar(Math.round(Math.random()*255),Math.round(Math.random()*255),Math.round(Math.random()*255));cv.drawContours(this.rgb1,this.contours,i,v,1,cv.LINE_8,this.hierarchy,100)}cv.imshow(this.displayCanvId,this.rgb1),this.contours.delete(),this.hierarchy.delete();let s=1e3/this.FPS-(Date.now()-e);setTimeout(this.startProcessing.bind(this),s)}loadImage(){this.context.drawImage(this.webcam,0,0,this.width,this.height),this.rgba1.data.set(this.context.getImageData(0,0,this.width,this.height).data)}stopProcessing(){this.stopped=!0,this.rgba1.delete(),this.rgb1.delete(),this.gray1.delete()}}const h=new r(150,130,3,60);let c=n.cloneNode(!0);n.parentElement.replaceChild(c,n),n.remove(),n=c,n.addEventListener("click",()=>{if(!u){h.stopProcessing(),d.video.facingMode==="environment"?d.video.facingMode="user":d.video.facingMode="environment",u=!0;let t=o.cloneNode(!0);o.parentElement.replaceChild(t,o),o.remove(),o=t,window.startAR()}}),navigator.mediaDevices.getUserMedia(d).then(function(t){console.log("Loading webcam..."),o.srcObject=t,o.play(),o.addEventListener("loadeddata",()=>{u=!1,h.onVideoLoaded(o,"transferCanvas","displayCanvas")})}).catch(function(t){console.log("An error occurred! "+t)})};
